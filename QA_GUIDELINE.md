# QAガイドライン

## 1. 目的
本ガイドラインは、Issue実装後の品質確認を一貫した基準で実施し、再現可能な証跡を残すことを目的とする。

## 2. 基本方針
- QAは**ユーザーストーリーの成立**を最優先で判定する。
- API単体成功のみでPassにしない。UI導線を含むE2E成立を確認する。
- 受け入れ条件は、証拠がある項目のみチェックする。
- 判定・コメント・報告は日本語で行う。
- 自動テスト責任範囲は以下とする。
  - 開発者責任: ドメイン単体テスト / API結合テスト
  - QA責任: UI E2Eテスト（`frontend/e2e/`）
- 上記責任範囲に対して自動テストが十分でない場合、QA判定はFailにする。
- Fail理由は不足している責任範囲を優先して明記する。特に開発者責任（単体/API結合）が不足している場合、QAコメントの主因はそれとし、E2E追加で代替しない。

## 3. ローカル検証前提
- `README.md` の「🚀 ローカル開発環境構築」に従う。
- DBはローカル起動 PostgreSQL 17 を使用する。
- バックエンドは必ず `--spring.profiles.active=local` で起動する。
- `backend/src/main/resources/application-local.yml` はローカル専用（コミットしない）。

## 4. QA実施フロー
1. 対象Issueと受け入れ条件を確認する。
2. `main` を最新化する。
3. ローカル起動確認を行う。
   - `curl -i http://127.0.0.1:8080/api/health`
   - `curl -I http://127.0.0.1:5173`
4. **Playwright MCPでUI/APIを受け入れ条件に沿って評価する。**
5. スクリーンショット等の証跡を保存する（`tmp/` 配下）。
6. MCP評価結果をもとに、必要に応じて `frontend/e2e/` の回帰テストを追加・更新する。
7. `pnpm e2e` を実行し、追加した回帰テストが安定して通ることを確認する。
   - 失敗時は、まずプロダクト不具合かテスト不備（待機不足・データ依存・不安定要因）かを切り分ける。
   - プロダクト不具合でない場合は、QA実施者が当該E2Eを修正し、`pnpm e2e` の再実行で全件成功を確認する。
8. 受け入れ条件ごとに「ドメイン単体 / API結合 / UI E2E」の自動テスト充足を確認する。
9. 自動テストが不足している場合はIssueへFailとして報告し、チェックボックスは更新しない。
10. IssueへQAコメントを投稿する（日時・コミット・判定根拠を明記）。
11. 全条件が満たされ、かつ自動テスト充足が確認できた場合のみIssueのチェックボックスを更新する。
12. 起動したプロセスを停止し、後始末する。

## 5. 判定基準（Pass/Fail）
- **Pass**
  - 受け入れ条件を満たす操作を、UI/APIで再現できる。
  - 成功結果が画面表示・レスポンスで確認できる。
  - 受け入れ条件に対応する自動テストが責任範囲ごとに十分に整備され、実行で成功している。
- **Fail**
  - UI導線不足、仕様不一致、想定外ステータス、再現不能がある。
  - ユーザーストーリー成立に必要な操作が欠ける。
  - 開発者責任（ドメイン単体 / API結合）またはQA責任（UI E2E）の自動テストが不足している。

## 6. 必須証跡
- 実行日時
- 対象ブランチ/コミット
- 受け入れ条件ごとのPass/Fail
- API確認結果（例: 未認証401、定員超過409）
- UIスクリーンショット（最低2枚）
  - 操作前
  - 成功状態（期待結果表示）
- テスト観点と実施箇所の対応表
  - 各受け入れ条件について、以下のどこで確認したかを明記する
    - ドメイン単体テスト（例: `backend/src/test/...`）
    - API結合テスト（例: `backend/src/test/...`）
    - UI E2E（例: `frontend/e2e/...`）
  - 未自動化の観点は「手動QAで確認」と明記する

### 6.1 スクリーンショットのブランチ運用ルール
- スクリーンショットは **`qa-issue{no}-report`** ブランチにpushする。  
  例: Issue #2 の場合 `qa-issue2-report`
- 画像URLは `main` ではなく、上記QAブランチを指すURLをIssueコメントに記載する。
- コメント例:
  - `https://github.com/<owner>/<repo>/blob/qa-issue2-report/tmp/qa-issue2-before-login.png?raw=1`
  - `https://github.com/<owner>/<repo>/blob/qa-issue2-report/tmp/qa-issue2-after-login.png?raw=1`

## 7. 回帰テスト運用（Playwright）
- E2E仕様は `frontend/e2e/` で管理する。
- 新規検証は、まず Playwright MCP で実動作確認してから、再発防止が必要な観点をE2Eへ反映する。
- 受け入れ条件に未カバー項目があれば、QA作業内でテストケース追加を検討する。
- 現在のカバレッジ:
  - `US-01` ゲストログイン
  - `US-02` キーノート予約主要導線
- ローカル実行:
  - `cd frontend && pnpm e2e`
- GitHub Actions:
  - E2Eは `.github/workflows/e2e-manual.yml` で管理。
  - `workflow_dispatch`（手動実行）のみ。

## 8. 禁止事項
- 証跡なしで受け入れ条件をチェックしない。
- 未確認項目を推測でPassにしない。
- 自動テスト不足の状態でQAをPassにしない。
- ローカル専用設定ファイルをコミットしない。
- サーバープロセスを起動したまま放置しない。

## 10. QA責任範囲
- QA実施者は、実行中に検出した回帰テストの失敗について、原因切り分けまでを必須対応とする。
- 失敗がテストコード起因（時間依存・データ依存・不安定要因）である場合、QA実施者は当該テストの修正と再実行確認までを担当する。
- テストコード起因と判断した場合、QA実施者はFail報告のみで終了せず、原則として同一QA作業内で修正PRまたは修正コミットまで行う。
- 失敗がプロダクト不具合起因の場合、QA実施者は再現手順・ログ・証跡を添えてIssueへ報告し、受け入れ条件判定をFailにする。
- 例外として、外部サービス障害や権限制約などで即時修正不能な場合は、阻害要因を明記してエスカレーションする。

## 9. Issueコメントテンプレート
```md
## QA結果
- 実行日時:
- 対象ブランチ/コミット:

### 受け入れ条件
- [ ] 条件1: Pass/Fail（根拠）
- [ ] 条件2: Pass/Fail（根拠）

### API確認
- 未認証アクセス:
- エラー系（409等）:

### UI確認
- 操作手順:
- 確認結果:

### スクリーンショット
- 画像1
- 画像2

### テスト観点と実施箇所
- 条件1:
  - ドメイン単体:
  - API結合:
  - UI E2E:
- 条件2:
  - ドメイン単体:
  - API結合:
  - UI E2E:

### 補足
- 非ブロッキング観測事項
```
