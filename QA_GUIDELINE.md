# QAガイドライン

## 1. 目的
本ガイドラインは、Issue実装後の品質確認を一貫した基準で実施し、再現可能な証跡を残すことを目的とする。

## 2. 基本方針
- QAは**ユーザーストーリーの成立**を最優先で判定する。
- API単体成功のみでPassにしない。UI導線を含むE2E成立を確認する。
- 受け入れ条件は、証拠がある項目のみチェックする。
- 判定・コメント・報告は日本語で行う。

## 3. ローカル検証前提
- `README.md` の「🚀 ローカル開発環境構築」に従う。
- DBはローカル起動 PostgreSQL 17 を使用する。
- バックエンドは必ず `--spring.profiles.active=local` で起動する。
- `backend/src/main/resources/application-local.yml` はローカル専用（コミットしない）。

## 4. QA実施フロー
1. 対象Issueと受け入れ条件を確認する。
2. `main` を最新化する。
3. ローカル起動確認を行う。
   - `curl -i http://127.0.0.1:8080/api/health`
   - `curl -I http://127.0.0.1:5173`
4. **Playwright MCPでUI/APIを受け入れ条件に沿って評価する。**
5. スクリーンショット等の証跡を保存する（`tmp/` 配下）。
6. MCP評価結果をもとに、必要に応じて `frontend/e2e/` の回帰テストを追加・更新する。
7. `pnpm e2e` を実行し、追加した回帰テストが安定して通ることを確認する。
8. IssueへQAコメントを投稿する（日時・コミット・判定根拠を明記）。
9. 全条件が満たされた場合のみIssueのチェックボックスを更新する。
10. 起動したプロセスを停止し、後始末する。

## 5. 判定基準（Pass/Fail）
- **Pass**
  - 受け入れ条件を満たす操作を、UI/APIで再現できる。
  - 成功結果が画面表示・レスポンスで確認できる。
- **Fail**
  - UI導線不足、仕様不一致、想定外ステータス、再現不能がある。
  - ユーザーストーリー成立に必要な操作が欠ける。

## 6. 必須証跡
- 実行日時
- 対象ブランチ/コミット
- 受け入れ条件ごとのPass/Fail
- API確認結果（例: 未認証401、定員超過409）
- UIスクリーンショット（最低2枚）
  - 操作前
  - 成功状態（期待結果表示）
- テスト観点と実施箇所の対応表
  - 各受け入れ条件について、以下のどこで確認したかを明記する
    - ドメイン単体テスト（例: `backend/src/test/...`）
    - API結合テスト（例: `backend/src/test/...`）
    - UI E2E（例: `frontend/e2e/...`）
  - 未自動化の観点は「手動QAで確認」と明記する

### 6.1 スクリーンショットのブランチ運用ルール
- スクリーンショットは **`qa-issue{no}-report`** ブランチにpushする。  
  例: Issue #2 の場合 `qa-issue2-report`
- 画像URLは `main` ではなく、上記QAブランチを指すURLをIssueコメントに記載する。
- コメント例:
  - `https://github.com/<owner>/<repo>/blob/qa-issue2-report/tmp/qa-issue2-before-login.png?raw=1`
  - `https://github.com/<owner>/<repo>/blob/qa-issue2-report/tmp/qa-issue2-after-login.png?raw=1`

## 7. 回帰テスト運用（Playwright）
- E2E仕様は `frontend/e2e/` で管理する。
- 新規検証は、まず Playwright MCP で実動作確認してから、再発防止が必要な観点をE2Eへ反映する。
- 受け入れ条件に未カバー項目があれば、QA作業内でテストケース追加を検討する。
- 現在のカバレッジ:
  - `US-01` ゲストログイン
  - `US-02` キーノート予約主要導線
- ローカル実行:
  - `cd frontend && pnpm e2e`
- GitHub Actions:
  - E2Eは `.github/workflows/e2e-manual.yml` で管理。
  - `workflow_dispatch`（手動実行）のみ。

## 8. 禁止事項
- 証跡なしで受け入れ条件をチェックしない。
- 未確認項目を推測でPassにしない。
- ローカル専用設定ファイルをコミットしない。
- サーバープロセスを起動したまま放置しない。

## 9. Issueコメントテンプレート
```md
## QA結果
- 実行日時:
- 対象ブランチ/コミット:

### 受け入れ条件
- [ ] 条件1: Pass/Fail（根拠）
- [ ] 条件2: Pass/Fail（根拠）

### API確認
- 未認証アクセス:
- エラー系（409等）:

### UI確認
- 操作手順:
- 確認結果:

### スクリーンショット
- 画像1
- 画像2

### テスト観点と実施箇所
- 条件1:
  - ドメイン単体:
  - API結合:
  - UI E2E:
- 条件2:
  - ドメイン単体:
  - API結合:
  - UI E2E:

### 補足
- 非ブロッキング観測事項
```
